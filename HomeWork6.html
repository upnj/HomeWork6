<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Upendra Joshi">

<title>HomeWork6</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="HomeWork6_files/libs/clipboard/clipboard.min.js"></script>
<script src="HomeWork6_files/libs/quarto-html/quarto.js"></script>
<script src="HomeWork6_files/libs/quarto-html/popper.min.js"></script>
<script src="HomeWork6_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="HomeWork6_files/libs/quarto-html/anchor.min.js"></script>
<link href="HomeWork6_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="HomeWork6_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="HomeWork6_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="HomeWork6_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="HomeWork6_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">HomeWork6</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Upendra Joshi </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="task-1-conceptual-questions" class="level1">
<h1>Task 1: Conceptual Questions</h1>
<section id="what-is-the-purpose-of-the-lapply-function-what-is-the-equivalent-purr-function" class="level2">
<h2 class="anchored" data-anchor-id="what-is-the-purpose-of-the-lapply-function-what-is-the-equivalent-purr-function">What is the purpose of the <code>lapply()</code> function? What is the equivalent <code>purr</code> function?</h2>
<p>The <code>lapply()</code> function is a variety of <code>apply()</code> that takes in a vector, a list, or a DataFrame as input and always outputs a list (“l” in the function name stands for “list”). The specified function applies to each element of the input object, hence the length of the resulting list is always equal to the input object’s length.</p>
<p>The syntax of this function is similar to the syntax of <code>apply()</code>, only here there is no need for the MARGIN parameter since the function applies element-wise for lists and vectors and column-wise for DataFrames:</p>
<p><code>purr::map()</code> is equivalent to <code>purr</code> functions. In the following link Hadley Wickham explained about the comparison of lapply() and map() functions. https://stackoverflow.com/questions/45101045/why-use-purrrmap-instead-of-lapply</p>
</section>
<section id="suppose-we-have-a-list-called-my_list.-each-element-of-the-list-is-a-numeric-data-frame-all-columns-are-numeric.-we-want-use-lapply-to-run-the-code-cornumeric_matrix-method-kendall-on-each-element-of-the-list.-write-code-to-do-this-below-im-really-trying-to-ask-you-how-you-specify-method-kendall-when-calling-lapply" class="level2">
<h2 class="anchored" data-anchor-id="suppose-we-have-a-list-called-my_list.-each-element-of-the-list-is-a-numeric-data-frame-all-columns-are-numeric.-we-want-use-lapply-to-run-the-code-cornumeric_matrix-method-kendall-on-each-element-of-the-list.-write-code-to-do-this-below-im-really-trying-to-ask-you-how-you-specify-method-kendall-when-calling-lapply">Suppose we have a list called my_list. Each element of the list is a numeric data frame (all columns are numeric). We want use lapply() to run the code cor(numeric_matrix, method = “kendall”) on each element of the list. Write code to do this below! (I’m really trying to ask you how you specify method = “kendall” when calling lapply())</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#result &lt;- lapply(my_list, function(x) cor(x, method ="kendall"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the above code lapply() applies a function to each element of the list.We use an anonymous function function(x) as the second argument to lapply(). Inside this anonymous function, we call cor(x, method = “kendall”). The x in the anonymous function represents each element of my_list in turn. The method = “kendall” argument is passed directly to the cor() function.</p>
</section>
<section id="what-are-two-advantages-of-using-purrr-functions-instead-of-the-baser-apply-family" class="level2">
<h2 class="anchored" data-anchor-id="what-are-two-advantages-of-using-purrr-functions-instead-of-the-baser-apply-family">What are two advantages of using purrr functions instead of the BaseR apply family?</h2>
<p>The two advantage of using purr functions over R basic functions are</p>
<ol type="1">
<li>Consistent naming and behavior:</li>
</ol>
<p>purrr functions have more consistent and intuitive naming conventions. For example, map() is used for applying a function to each element of a list or vector, regardless of the output type. In contrast, base R has different functions like lapply(), sapply(), and vapply() for similar operations, which can be confusing for beginners. purrr functions also have more predictable return types. For instance, map() always returns a list, while sapply() in base R might return a vector, matrix, or list depending on the output, which can lead to unexpected behavior.</p>
<ol start="2" type="1">
<li>Type-specific variants and shortcuts:</li>
</ol>
<p>purrr provides type-specific variants of its functions, making it easier to ensure specific output types. For example:</p>
<p>map_dbl() for numeric output map_chr() for character output map_lgl() for logical output</p>
<p>These variants help catch type mismatches early and make the code’s intent clearer. purrr also offers shortcut syntax for common operations. For example, you can use map(list, “column_name”) to extract a specific column from each data frame in a list, which is more concise than writing a full anonymous function. These advantages contribute to more readable, maintainable, and less error-prone code, especially when working with complex nested data structures or performing multiple operations in sequence.</p>
</section>
<section id="what-is-a-side-effect-function" class="level2">
<h2 class="anchored" data-anchor-id="what-is-a-side-effect-function">What is a side-effect function?</h2>
<p>A side-effect function in R is a function that modifies something outside of its local environment or performs an action beyond simply returning a value. These functions are called primarily for their side effects rather than for their return values. Key characteristics of side-effect functions include:</p>
<ol type="1">
<li>They often modify the global environment or external state.</li>
<li>They may perform I/O operations like writing to a file or printing to the console.</li>
<li>Their primary purpose is to cause some change or action, not to compute and return a value.</li>
</ol>
</section>
<section id="why-can-you-name-a-variable-sd-in-a-function-and-not-cause-any-issues-with-the-sd-function" class="level2">
<h2 class="anchored" data-anchor-id="why-can-you-name-a-variable-sd-in-a-function-and-not-cause-any-issues-with-the-sd-function">Why can you name a variable sd in a function and not cause any issues with the sd function?</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (x, na.rm = FALSE) 
sqrt(var(if (is.vector(x) || is.factor(x)) x else as.double(x), 
    na.rm = na.rm))
&lt;bytecode: 0x0000022c060baa40&gt;
&lt;environment: namespace:stats&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; function (x, na.rm = FALSE) </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sqrt(var(if (is.vector(x) || is.factor(x)) x else as.double(x), </span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     na.rm = na.rm))</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;bytecode: 0x0000000017e687b8&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;environment: namespace:stats&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>sd <span class="ot">&lt;-</span> <span class="fl">12.2</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 12.2</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.02765</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 3.02765</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>R has separate namespaces for functions and variables. Depending on the context in which a name occurs, R will look up the name in one namespace or in the other.</p>
<p>For instance, the expression sd(1:10) is a call and the first element in a call must be the name of a function. Therefore, in this case, R will look for a function named sd.</p>
<p>On the other hand, the expression sd is not a call but a name, which could be either the name of a variable or the name of a function. In this case R will look first for the first object in the search path named sd regardless of whether it’s a function or another type of object.</p>
</section>
</section>
<section id="task-2---writting-r-functions" class="level1">
<h1>Task 2 - Writting R Functions</h1>
<p>When we start doing machine learning later in the course, a common metric used to evaluate predictions is called Root Mean Square Error (RMSE). For a given set of responses, y1, …, yn (variable of interest that we want to predict) and a set of corresponding predictions for those observations, ˆy1, …, ˆyn the RMSE is defined as RMSE is the square root of the average of the squared differences between the predicted and actual values.</p>
<section id="rmse-function" class="level2">
<h2 class="anchored" data-anchor-id="rmse-function">RMSE Function</h2>
<p>Write a basic function (call it getRMSE()) that takes in a vector of responses and a vector of predictions and outputs the RMSE. • If a value is missing for the vector of responses (i.e.&nbsp;an NA is present), allow for additional arguments to the mean() function (elipses) that removes the NA values in the computation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>getRMSE <span class="ot">&lt;-</span> <span class="cf">function</span>(y, y_hat, ...) {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if the lengths of y and y_hat are the same</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(y) <span class="sc">!=</span> <span class="fu">length</span>(y_hat)) {</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"The lengths of actual values and predictions must be the same."</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove pairs where y is NA</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  valid_indices <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.na</span>(y)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> y[valid_indices]</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  y_hat <span class="ot">&lt;-</span> y_hat[valid_indices]</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the squared differences</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  squared_diff <span class="ot">&lt;-</span> (y <span class="sc">-</span> y_hat)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the mean of squared differences, allowing for additional arguments</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  mean_squared_diff <span class="ot">&lt;-</span> <span class="fu">mean</span>(squared_diff, ...)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate RMSE</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(mean_squared_diff)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(rmse)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s apply this function to some actual and predicted values</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>actual <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="cn">NA</span>, <span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>predicted <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.1</span>, <span class="fl">2.2</span>, <span class="fl">2.9</span>, <span class="fl">4.1</span>, <span class="fl">5.2</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Using the function with default behavior (NA values removed)</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>result1 <span class="ot">&lt;-</span> <span class="fu">getRMSE</span>(actual, predicted)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1581139</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Explicitly specifying na.rm = TRUE</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>result2 <span class="ot">&lt;-</span> <span class="fu">getRMSE</span>(actual, predicted, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1581139</code></pre>
</div>
</div>
<p>Run the following code to create some response values and predictions. set.seed(10) n &lt;- 100 x &lt;- runif(n) resp &lt;- 3 + 10 * x + rnorm(n) pred &lt;- predict(lm(resp ~ x), data.frame(x)) • Test your RMSE function using this data. • Repeat after replacing two of the response values with missing values (NA_real_). – Test your RMSE function with and without specifying the behavior to deal with missing values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(n)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>resp <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="sc">+</span> <span class="dv">10</span> <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="fu">lm</span>(resp <span class="sc">~</span> x), <span class="fu">data.frame</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now Let’s test our RMSE function with this data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test RMSE function with original data</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>rmse_original <span class="ot">&lt;-</span> <span class="fu">getRMSE</span>(resp, pred)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"RMSE with original data:"</span>, rmse_original))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "RMSE with original data: 0.958167655151933"</code></pre>
</div>
</div>
<p>Now Let’s replace two of the response values with NA_real_ and test again:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace two response values with NA</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>resp_with_na <span class="ot">&lt;-</span> resp</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>resp_with_na[<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">50</span>)] <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Test RMSE function with NA values, without specifying na.rm</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>rmse_with_na <span class="ot">&lt;-</span> <span class="fu">getRMSE</span>(resp_with_na, pred)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"RMSE with NA values (default behavior):"</span>, rmse_with_na))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "RMSE with NA values (default behavior): 0.960318742971636"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test RMSE function with NA values, explicitly specifying na.rm = TRUE</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>rmse_with_na_explicit <span class="ot">&lt;-</span> <span class="fu">getRMSE</span>(resp_with_na, pred, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"RMSE with NA values (explicitly specifying na.rm = TRUE):"</span>, rmse_with_na_explicit))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "RMSE with NA values (explicitly specifying na.rm = TRUE): 0.960318742971636"</code></pre>
</div>
</div>
</section>
<section id="mae-function" class="level2">
<h2 class="anchored" data-anchor-id="mae-function">MAE Function</h2>
<p>Another common metric for evaluating predictions is mean absolute deviation given by Write a function called getMAE() that follows the specifications of the getRMSE() function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>getMAE <span class="ot">&lt;-</span> <span class="cf">function</span>(y, y_hat, ...) {</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if the lengths of y and y_hat are the same</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(y) <span class="sc">!=</span> <span class="fu">length</span>(y_hat)) {</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"The lengths of actual values and predictions must be the same."</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove pairs where y is NA</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  valid_indices <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.na</span>(y)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> y[valid_indices]</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  y_hat <span class="ot">&lt;-</span> y_hat[valid_indices]</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the absolute differences</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  abs_diff <span class="ot">&lt;-</span> <span class="fu">abs</span>(y <span class="sc">-</span> y_hat)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the mean of absolute differences, allowing for additional arguments</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  mae <span class="ot">&lt;-</span> <span class="fu">mean</span>(abs_diff, ...)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(mae)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Run the following code to create some response values and predictions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(n)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>resp <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="sc">+</span> <span class="dv">10</span> <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="fu">lm</span>(resp <span class="sc">~</span> x), <span class="fu">data.frame</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>• Test your MAE function using this data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test MAE function with original data</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>mae_original <span class="ot">&lt;-</span> <span class="fu">getMAE</span>(resp, pred)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"MAE with original data:"</span>, mae_original))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "MAE with original data: 0.815577593682669"</code></pre>
</div>
</div>
<p>• Repeat after replacing two of the response values with missing values (NA_real_). – Test your MAE function with and without specifying the behavior to deal with missing values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace two response values with NA</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>resp_with_na <span class="ot">&lt;-</span> resp</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>resp_with_na[<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">50</span>)] <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Test MAE function with NA values, without specifying na.rm</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>mae_with_na <span class="ot">&lt;-</span> <span class="fu">getMAE</span>(resp_with_na, pred)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"MAE with NA values (default behavior):"</span>, mae_with_na))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "MAE with NA values (default behavior): 0.815463413520463"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test MAE function with NA values, explicitly specifying na.rm = TRUE</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>mae_with_na_explicit <span class="ot">&lt;-</span> <span class="fu">getMAE</span>(resp_with_na, pred, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"MAE with NA values (explicitly specifying na.rm = TRUE):"</span>, mae_with_na_explicit))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "MAE with NA values (explicitly specifying na.rm = TRUE): 0.815463413520463"</code></pre>
</div>
</div>
</section>
<section id="wrapper-function" class="level2">
<h2 class="anchored" data-anchor-id="wrapper-function">Wrapper Function</h2>
<p>Let’s create a wrapper function that can be used to get either or both metrics returned with a single function call. Do not rewrite your above two functions, call them inside the wrapper function (we would call the getRMSE() and getMAE() functions helper functions). When returning your values, give them appropriate names. • The function should check that two numeric (atomic) vectors have been passed (consider is.vector(), is.atomic(), and is.numeric()). If not, a message should print and the function should exit. • The function should return both metrics by default and include names. The behavior should be able to be changed using a character string of metrics to find.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>getPredictionMetrics <span class="ot">&lt;-</span> <span class="cf">function</span>(actual, predicted, <span class="at">metrics =</span> <span class="fu">c</span>(<span class="st">"RMSE"</span>, <span class="st">"MAE"</span>), ...) {</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if inputs are numeric atomic vectors</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.vector</span>(actual) <span class="sc">||</span> <span class="sc">!</span><span class="fu">is.atomic</span>(actual) <span class="sc">||</span> <span class="sc">!</span><span class="fu">is.numeric</span>(actual) <span class="sc">||</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.vector</span>(predicted) <span class="sc">||</span> <span class="sc">!</span><span class="fu">is.atomic</span>(predicted) <span class="sc">||</span> <span class="sc">!</span><span class="fu">is.numeric</span>(predicted)) {</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Error: Both inputs must be numeric atomic vectors."</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if lengths match</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(actual) <span class="sc">!=</span> <span class="fu">length</span>(predicted)) {</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Error: The lengths of actual and predicted values must be the same."</span>)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initialize results list</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate requested metrics</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"RMSE"</span> <span class="sc">%in%</span> metrics) {</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    results<span class="sc">$</span>RMSE <span class="ot">&lt;-</span> <span class="fu">getRMSE</span>(actual, predicted, ...)</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"MAE"</span> <span class="sc">%in%</span> metrics) {</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>    results<span class="sc">$</span>MAE <span class="ot">&lt;-</span> <span class="fu">getMAE</span>(actual, predicted, ...)</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if any valid metrics were calculated</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(results) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Error: No valid metrics specified. Please use 'RMSE' and/or 'MAE'."</span>)</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results)</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Run the following code to create some response values and predictions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(n)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>resp <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="sc">+</span> <span class="dv">10</span> <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="fu">lm</span>(resp <span class="sc">~</span> x), <span class="fu">data.frame</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Test your new function using this data. Call it once asking for each metric individually and once specifying both metrics</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSE only</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>rmse_result <span class="ot">&lt;-</span> <span class="fu">getPredictionMetrics</span>(resp, pred, <span class="at">metrics =</span> <span class="st">"RMSE"</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"RMSE only:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "RMSE only:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rmse_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$RMSE
[1] 0.9581677</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># MAE only</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>mae_result <span class="ot">&lt;-</span> <span class="fu">getPredictionMetrics</span>(resp, pred, <span class="at">metrics =</span> <span class="st">"MAE"</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"MAE only:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "MAE only:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mae_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$MAE
[1] 0.8155776</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Both metrics</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>both_metrics <span class="ot">&lt;-</span> <span class="fu">getPredictionMetrics</span>(resp, pred)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Both metrics:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Both metrics:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(both_metrics)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$RMSE
[1] 0.9581677

$MAE
[1] 0.8155776</code></pre>
</div>
</div>
<p>• Repeat with replacing two of the response values with missing values (NA_real_).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace two response values with NA</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>resp_with_na <span class="ot">&lt;-</span> resp</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>resp_with_na[<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">50</span>)] <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Both metrics with NA values</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>both_metrics_na <span class="ot">&lt;-</span> <span class="fu">getPredictionMetrics</span>(resp_with_na, pred)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Both metrics with NA values:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Both metrics with NA values:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(both_metrics_na)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$RMSE
[1] 0.9603187

$MAE
[1] 0.8154634</code></pre>
</div>
</div>
<p>• Finally, test your function by passing it incorrect data (i.e.&nbsp;a data frame or something else instead of vectors)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test with a data frame instead of a vector</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>df_test <span class="ot">&lt;-</span> <span class="fu">getPredictionMetrics</span>(<span class="fu">as.data.frame</span>(resp), pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Error: Both inputs must be numeric atomic vectors.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test with mismatched lengths</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>length_test <span class="ot">&lt;-</span> <span class="fu">getPredictionMetrics</span>(resp[<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>], pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Error: The lengths of actual and predicted values must be the same.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test with non-numeric data</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>char_test <span class="ot">&lt;-</span> <span class="fu">getPredictionMetrics</span>(<span class="fu">as.character</span>(resp), pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Error: Both inputs must be numeric atomic vectors.</code></pre>
</div>
</div>
</section>
</section>
<section id="task-3-querying-an-api-and-a-tidy-style-function" class="level1">
<h1>Task 3 Querying an API and a Tidy-Style Function</h1>
<p>For this section, you’ll connect to the news API here: newsapi.org. You’ll need to go to register for a key at that web site! 1. Use GET() from the httr package to return information about a topic that you are interested in that has been in the news lately (store the result as an R object). Note: We can only look 30 days into the past with a free account.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'lubridate'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    date, intersect, setdiff, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>api_key <span class="ot">&lt;-</span> <span class="st">"d7e889ee842f42be9e410edf7a16d508"</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>topic <span class="ot">&lt;-</span> <span class="st">"tesla"</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the date 29 days ago</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>from_date <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">Sys.Date</span>() <span class="sc">-</span> <span class="dv">29</span>, <span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"https://newsapi.org/v2/everything?q="</span>, <span class="fu">URLencode</span>(topic), </span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>              <span class="st">"&amp;from="</span>, from_date, <span class="st">"&amp;sortBy=publishedAt&amp;apiKey="</span>, api_key)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> <span class="fu">GET</span>(url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Parse what is returned and find your way to the data frame that has the actual article information in it (check content). Use the pluck() function from purrr to grab the articles element. Note the first column should be a list column!</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>content <span class="ot">&lt;-</span> <span class="fu">content</span>(response, <span class="st">"parsed"</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="co">#str(content)</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co">#str(content$articles)</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Use pluck to get the article</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>articles <span class="ot">&lt;-</span> <span class="fu">pluck</span>(content, <span class="st">"articles"</span>)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="co">#create a data frame</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>articles_df <span class="ot">&lt;-</span> <span class="fu">map_df</span>(content<span class="sc">$</span>articles, <span class="sc">~</span> {</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">source =</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(.<span class="sc">$</span>source<span class="sc">$</span>name), <span class="cn">NA</span>, .<span class="sc">$</span>source<span class="sc">$</span>name),</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">author =</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(.<span class="sc">$</span>author), <span class="cn">NA</span>, .<span class="sc">$</span>author),</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(.<span class="sc">$</span>title), <span class="cn">NA</span>, .<span class="sc">$</span>title),</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">description =</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(.<span class="sc">$</span>description), <span class="cn">NA</span>, .<span class="sc">$</span>description),</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">url =</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(.<span class="sc">$</span>url), <span class="cn">NA</span>, .<span class="sc">$</span>url),</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">publishedAt =</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(.<span class="sc">$</span>publishedAt), <span class="cn">NA</span>, .<span class="sc">$</span>publishedAt),</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">content =</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(.<span class="sc">$</span>content), <span class="cn">NA</span>, .<span class="sc">$</span>content),</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the structure of the first few rows</span></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">head</span>(articles_df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   6 obs. of  7 variables:
 $ source     : chr  "Unwire.hk" "Www.nzz.ch" "Storm.mg" "Biztoc.com" ...
 $ author     : chr  "藍骨" "Marie-Astrid Langer (lma)" "小七車觀點" "investorplace.com" ...
 $ title      : chr  "Volvo EM90 護航首屆香港演藝博覽　純電 MPV 展現北歐格調與藝術魅力" "Elon Musk unterstützt Trump, Steve Jobs’ Witwe mag Harris. Warum das Silicon Valley für den Wahlkampf so wichtig ist" "Model Y HW4.0、EX40、EC40 等多款新車現身　經濟部能源署 2024 年 9 月份油耗暨電動車能耗測試出爐" "Tesla’s “Disappointing” Robotaxi Event" ...
 $ description: chr  "西九文化區最近舉辦了首屆香港演藝博覽，期間匯聚了來自世界各地的藝術家與尊貴嘉賓，而 Volvo 作為此次博覽的官方合作"| __truncated__ "Amerikas Technologie-Mekka gilt als Hochburg der Demokraten. Doch bei genauerem Hinsehen zeigt sich, dass viele"| __truncated__ "經濟部能源署今日 (10/15) 公布 2024年 9月份燃油車油耗及電動車能耗測試結果，在國產車部分，..." "InvestorPlace - Stock Market News, Stock Advice &amp; Trading Tips\n“We, Robot” from Tesla lets down investors … wh"| __truncated__ ...
 $ url        : chr  "https://unwire.hk/2024/10/16/volvo-em90-hong-kong-performing-arts-expo/life-tech/auto/" "https://www.nzz.ch/pro/trump-gegen-harris-die-rolle-des-silicon-valley-im-us-wahlkampf-ld.1852457" "https://www.storm.mg/lifestyle/5255591" "https://biztoc.com/x/3a79d0ffeefa4a0c" ...
 $ publishedAt: chr  "2024-10-16T03:30:40Z" "2024-10-16T03:30:00Z" "2024-10-16T03:27:45Z" "2024-10-16T03:20:02Z" ...
 $ content    : chr  "Volvo MPV EM90 \r\n (Hong Kong Performing Arts Expo) 5 \r\n Volvo EM90 \r\nEM90 Volvo \r\n Volvo \r\nEM90 Volvo"| __truncated__ "Bei einem Wahlkampfauftritt in Butler, Pennsylvania, im Oktober macht Elon Musk Werbung für Donald Trump. Den f"| __truncated__ "(10/15) 2024&nbsp; 9&nbsp; () \r\n&amp;lt;Google&amp;gt; \r\n9&nbsp; Mercedes-AMG E 53 HYBRID 4MATIC+ BMW 530i Audi Q7 TFSI quattro Me"| __truncated__ "InvestorPlace - Stock Market News, Stock Advice &amp;amp; Trading TipsWe, Robot from Tesla lets down investors why "| __truncated__ ...</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>Now write a quick function that allows the user to easily query this API. The inputs to the function should be the title/subject to search for (string), a time period to search from (string - you’ll search from that time until the present), and an API key.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>get_news <span class="ot">&lt;-</span> <span class="cf">function</span>(subject, <span class="at">from_date =</span> <span class="cn">NULL</span>, api_key) {</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the earliest allowed date (30 days ago)</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  earliest_allowed_date <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">Sys.Date</span>() <span class="sc">-</span> <span class="dv">29</span>, <span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If from_date is not provided or is earlier than the earliest allowed date,</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># use the earliest allowed date</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(from_date) <span class="sc">||</span> <span class="fu">as.Date</span>(from_date) <span class="sc">&lt;</span> <span class="fu">as.Date</span>(earliest_allowed_date)) {</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>    from_date <span class="ot">&lt;-</span> earliest_allowed_date</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Construct the URL</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>  base_url <span class="ot">&lt;-</span> <span class="st">"https://newsapi.org/v2/everything"</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>  query <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">q =</span> subject,</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">from =</span> from_date,</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">sortBy =</span> <span class="st">"publishedAt"</span>,</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">apiKey =</span> api_key</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make the API request</span></span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>  response <span class="ot">&lt;-</span> <span class="fu">GET</span>(base_url, <span class="at">query =</span> query)</span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if the request was successful</span></span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">status_code</span>(response) <span class="sc">!=</span> <span class="dv">200</span>) {</span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"API request failed with status code: "</span>, <span class="fu">status_code</span>(response))</span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Parse the content</span></span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>  content <span class="ot">&lt;-</span> <span class="fu">content</span>(response, <span class="st">"parsed"</span>)</span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract articles using pluck</span></span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a>  articles <span class="ot">&lt;-</span> <span class="fu">pluck</span>(content, <span class="st">"articles"</span>)</span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the data frame</span></span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a>  articles_df <span class="ot">&lt;-</span> <span class="fu">map_df</span>(articles, <span class="sc">~</span> {</span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">source =</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(.<span class="sc">$</span>source<span class="sc">$</span>name), <span class="cn">NA</span>, .<span class="sc">$</span>source<span class="sc">$</span>name),</span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">author =</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(.<span class="sc">$</span>author), <span class="cn">NA</span>, .<span class="sc">$</span>author),</span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(.<span class="sc">$</span>title), <span class="cn">NA</span>, .<span class="sc">$</span>title),</span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">description =</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(.<span class="sc">$</span>description), <span class="cn">NA</span>, .<span class="sc">$</span>description),</span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">url =</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(.<span class="sc">$</span>url), <span class="cn">NA</span>, .<span class="sc">$</span>url),</span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">publishedAt =</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(.<span class="sc">$</span>publishedAt), <span class="cn">NA</span>, .<span class="sc">$</span>publishedAt),</span>
<span id="cb63-43"><a href="#cb63-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">content =</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(.<span class="sc">$</span>content), <span class="cn">NA</span>, .<span class="sc">$</span>content),</span>
<span id="cb63-44"><a href="#cb63-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb63-45"><a href="#cb63-45" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb63-46"><a href="#cb63-46" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb63-47"><a href="#cb63-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-48"><a href="#cb63-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(articles_df)</span>
<span id="cb63-49"><a href="#cb63-49" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Use your function twice to grab some data (save each as an object)!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># API key</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>api_key <span class="ot">&lt;-</span> <span class="st">"d7e889ee842f42be9e410edf7a16d508"</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get news about Tesla from the last 30 days</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>tesla_news <span class="ot">&lt;-</span> <span class="fu">get_news</span>(<span class="st">"Tesla"</span>, <span class="st">"2024-09-16"</span>, api_key)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get news about artificial intelligence from the last week</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>ai_news <span class="ot">&lt;-</span> <span class="fu">get_news</span>(<span class="st">"artificial intelligence"</span>, <span class="st">"2024-10-09"</span>, api_key)</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the results</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(tesla_news)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   100 obs. of  7 variables:
 $ source     : chr  "Unwire.hk" "Www.nzz.ch" "Storm.mg" "Biztoc.com" ...
 $ author     : chr  "藍骨" "Marie-Astrid Langer (lma)" "小七車觀點" "investorplace.com" ...
 $ title      : chr  "Volvo EM90 護航首屆香港演藝博覽　純電 MPV 展現北歐格調與藝術魅力" "Elon Musk unterstützt Trump, Steve Jobs’ Witwe mag Harris. Warum das Silicon Valley für den Wahlkampf so wichtig ist" "Model Y HW4.0、EX40、EC40 等多款新車現身　經濟部能源署 2024 年 9 月份油耗暨電動車能耗測試出爐" "Tesla’s “Disappointing” Robotaxi Event" ...
 $ description: chr  "西九文化區最近舉辦了首屆香港演藝博覽，期間匯聚了來自世界各地的藝術家與尊貴嘉賓，而 Volvo 作為此次博覽的官方合作"| __truncated__ "Amerikas Technologie-Mekka gilt als Hochburg der Demokraten. Doch bei genauerem Hinsehen zeigt sich, dass viele"| __truncated__ "經濟部能源署今日 (10/15) 公布 2024年 9月份燃油車油耗及電動車能耗測試結果，在國產車部分，..." "InvestorPlace - Stock Market News, Stock Advice &amp; Trading Tips\n“We, Robot” from Tesla lets down investors … wh"| __truncated__ ...
 $ url        : chr  "https://unwire.hk/2024/10/16/volvo-em90-hong-kong-performing-arts-expo/life-tech/auto/" "https://www.nzz.ch/pro/trump-gegen-harris-die-rolle-des-silicon-valley-im-us-wahlkampf-ld.1852457" "https://www.storm.mg/lifestyle/5255591" "https://biztoc.com/x/3a79d0ffeefa4a0c" ...
 $ publishedAt: chr  "2024-10-16T03:30:40Z" "2024-10-16T03:30:00Z" "2024-10-16T03:27:45Z" "2024-10-16T03:20:02Z" ...
 $ content    : chr  "Volvo MPV EM90 \r\n (Hong Kong Performing Arts Expo) 5 \r\n Volvo EM90 \r\nEM90 Volvo \r\n Volvo \r\nEM90 Volvo"| __truncated__ "Bei einem Wahlkampfauftritt in Butler, Pennsylvania, im Oktober macht Elon Musk Werbung für Donald Trump. Den f"| __truncated__ "(10/15) 2024&nbsp; 9&nbsp; () \r\n&amp;lt;Google&amp;gt; \r\n9&nbsp; Mercedes-AMG E 53 HYBRID 4MATIC+ BMW 530i Audi Q7 TFSI quattro Me"| __truncated__ "InvestorPlace - Stock Market News, Stock Advice &amp;amp; Trading TipsWe, Robot from Tesla lets down investors why "| __truncated__ ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(ai_news)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   100 obs. of  7 variables:
 $ source     : chr  "Knowyourmeme.com" "The BMJ" "The BMJ" "Investing.com" ...
 $ author     : chr  NA "Bitomsky, L., Pfitzer, E. C., Nissen, M., Kowatsch, T." "Liao, Y., Ye, L., Cai, Q., Song, H., Zhao, Y., Shang, X., Tian, T." "Investing.com" ...
 $ title      : chr  "Joyland.ai" "Advancing health equity and the role of digital health technologies: a scoping review protocol" "Status and influencing factors of knowledge, attitudes and practices relating to screening for breast and cervi"| __truncated__ "Forecasted Dry, Northerly Winds Mean PG&amp;E May Need to Proactively Shut Off Power for Safety to Approximately 28"| __truncated__ ...
 $ description: chr  "Welcome to Joyland, the digital playground where your creativity meets artificial intelligence. This isn't just"| __truncated__ "Introduction\r\n\nHealthcare systems around the world exhibit inherent systemic inequities that disproportionat"| __truncated__ "Objectives The objectives are to investigate the status of knowledge, attitudes and practices (KAP) and to iden"| __truncated__ "Forecasted Dry, Northerly Winds Mean PG&amp;E May Need to Proactively Shut Off Power for Safety to Approximately 28"| __truncated__ ...
 $ url        : chr  "https://knowyourmeme.com/memes/joylandai" "https://bmjopen.bmj.com/content/14/10/e082336" "https://bmjopen.bmj.com/content/14/10/e080945" "https://www.investing.com/news/press-releases/forecasted-dry-northerly-winds-mean-pge-may-need-to-proactively-s"| __truncated__ ...
 $ publishedAt: chr  "2024-10-16T03:24:50Z" "2024-10-16T03:18:58Z" "2024-10-16T03:18:58Z" "2024-10-16T03:12:04Z" ...
 $ content    : chr  "Welcome to Joyland, the digital playground where your creativity meets artificial intelligence. This isn't just"| __truncated__ "Introduction\r\nAs of 2017, non-communicable diseases (NCDs) such as cancer, diabetes, cardiovascular diseases "| __truncated__ "Introduction\r\nBreast and cervical cancer are among the most common cancers and leading causes of death in wom"| __truncated__ "PG&amp;amp;E'sEmergency Operations Center is Open and Company Meteorologists and Operations Professionals are Monit"| __truncated__ ...</code></pre>
</div>
</div>
<ol start="4" type="1">
<li>With one of your objects, summarize the name of the source for each article. That is, find a one-way contingency table for this information.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a one-way contingency table of the sources</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>source_table <span class="ot">&lt;-</span> <span class="fu">table</span>(tesla_news<span class="sc">$</span>source)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(source_table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                [Removed]            Aftonbladet.se                   ANSA.it 
                        1                         3                         1 
                  Autocar                  BBC News       Berliner Morgenpost 
                        1                         1                         2 
               Biztoc.com             Boston Herald            Breitbart News 
                        2                         1                         1 
         Business Insider            Caradisiac.com             CleanTechnica 
                        2                         1                         1 
                 CoinDesk       Commercial Observer               CryptoSlate 
                        1                         1                         1 
             Daily Signal                   Decrypt                    Dezeen 
                        1                         1                         1 
                 DIE WELT             Diepresse.com              Droidnews.ru 
                        2                         1                         1 
                 Electrek             Elespanol.com                  Feber.se 
                        5                         1                         4 
                   Forbes                   Fortune                 Frandroid 
                        2                         1                         1 
              Gizmodo.com             GlobeNewswire                  HuffPost 
                        3                         1                         2 
                      IGN             Ilgiornale.it                 InfoMoney 
                        1                         1                         1 
            Investing.com Investor's Business Daily              Jungewelt.de 
                        2                         1                         1 
                La Nacion                  NBC News                 New Atlas 
                        1                         1                         1 
        New York Magazine           Next Big Future       Olhardigital.com.br 
                        1                         1                         1 
          Overclockers.ru              Quartz India                        RT 
                        2                         1                         1 
                  Sapo.pt       Securityaffairs.com              Slashdot.org 
                        1                         1                         6 
                 Storm.mg         Svenska Dagbladet                TechCrunch 
                        2                         1                         1 
                 TechSpot              Telepolis.de              The Diplomat 
                        1                         1                         1 
        The Week Magazine              Thebridge.jp      Thegatewaypundit.com 
                        1                         1                         1 
              Tistory.com              Tuxboard.com                 TweakTown 
                        1                         1                         3 
                Unwire.hk                       Vox                Www.nzz.ch 
                        1                         1                         1 
            Xataka.com.mx       Yahoo Entertainment 
                        5                         5 </code></pre>
</div>
</div>
<ol start="5" type="1">
<li>For each of your returned data objects, turn the publishedAt column into a date column using the lubridate package (see the PARSE DATE-TIMES section of the cheat sheet!). Then sort the two data frames, each by their new parsed date published column. Finally, create a new variable called pub_diff that is the difference in time between the articles’ published dates (use lag() with mutate()). Save the modifications as new data frames.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to process each data frame</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>process_news_df <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Parse the publishedAt column into a datetime</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">publishedAt =</span> <span class="fu">ymd_hms</span>(publishedAt)) <span class="sc">%&gt;%</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by the parsed date</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(publishedAt) <span class="sc">%&gt;%</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create the pub_diff column</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">pub_diff =</span> <span class="fu">difftime</span>(publishedAt, <span class="fu">lag</span>(publishedAt), <span class="at">units =</span> <span class="st">"hours"</span>))</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Process tesla_news</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>tesla_news_processed <span class="ot">&lt;-</span> <span class="fu">process_news_df</span>(tesla_news)</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Process ai_news</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>ai_news_processed <span class="ot">&lt;-</span> <span class="fu">process_news_df</span>(ai_news)</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the results</span></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(tesla_news_processed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   100 obs. of  8 variables:
 $ source     : chr  "Frandroid" "Tuxboard.com" "Quartz India" "ANSA.it" ...
 $ author     : chr  "Grégoire Huvelin" "B. L." "Owen Bellwood / Jalopnik" NA ...
 $ title      : chr  "Twitch Survoltés #2&nbsp;: une émission spéciale « Mondial de l’auto », tout le programme et les invités" "Les modèles de voitures qui seront interdits de circuler à partir du 1er janvier 2025" "America just set an EV sales record" "Andrea Stroppa, il braccio destro in Italia di Musk" ...
 $ description: chr  "Notre seconde émission Twitch Survoltés fait la part belle au Mondial de l’Automobile&nbsp;2024, organisé à Paris du"| __truncated__ "C’est la dure loi des voitures… À partir du 1ᵉʳ janvier prochain, certains modèles de voitures n’auront plus le"| __truncated__ "In recent months, automakers around the world have pledged to shift attention to hybrid models, delay new elect"| __truncated__ "30 anni, ex hacker. Fu consulente di Renzi alla cybersicurezza (ANSA)" ...
 $ url        : chr  "https://www.frandroid.com/survoltes/voitures-electriques/2369530_twitch-survoltes-2-une-emission-speciale-mondi"| __truncated__ "https://www.tuxboard.com/les-modeles-de-voiture-qui-seront-interdits-de-circuler-a-partir-du-1er-janvier-2025-14102024/" "https://qz.com/ev-electric-car-sales-record-us-1851672969" "https://www.ansa.it/sito/notizie/cronaca/2024/10/15/andrea-stroppa-il-braccio-destro-in-italia-di-musk_03594a99"| __truncated__ ...
 $ publishedAt: POSIXct, format: "2024-10-15 17:01:00" "2024-10-15 17:04:20" ...
 $ content    : chr  "Notre seconde émission Twitch Survoltés fait la part belle au Mondial de lAutomobile&nbsp;2024, organisé à Paris du "| __truncated__ "Tesla s’est imposée comme le leader du marché électrique en France, avec son SUV Model Y (37 127 unités vendues"| __truncated__ "In This Story\r\nIn recent months, automakers around the world have pledged to shift attention to hybrid models"| __truncated__ "Un enfant prodige dell'informatica arrivato, a soli 30 anni, ad essere il punto di riferimento di Elon Musk in "| __truncated__ ...
 $ pub_diff   : 'difftime' num  NA 0.0555555555555556 0.0075 0.0119444444444444 ...
  ..- attr(*, "units")= chr "hours"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(ai_news_processed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   100 obs. of  8 variables:
 $ source     : chr  "pymnts.com" "pymnts.com" "Nextgov" "Wired" ...
 $ author     : chr  "PYMNTS" "PYMNTS" "Natalie Alms and David DiMolfetta" "Megan Farokhmanesh, Lauren Goode" ...
 $ title      : chr  "Aethir Launches $100 Million AI Fund as Sony Seeks AI Game Patent" "Amazon Debuts AI-Powered Tools for Creating Advertisements" "White House probes the collision of AI and personal data" "Anyone Can Turn You Into an AI Chatbot. There's Little You Can Do to Stop Them" ...
 $ description: chr  "Artificial intelligence (AI) is opening up fresh possibilities across the gaming and sports betting sectors. Re"| __truncated__ "Amazon Ads has debuted two artificial intelligence (AI) tools designed to help advertisers expand their reach. "| __truncated__ "Policymakers are examining how the advent of artificial intelligence could create new privacy risks around the "| __truncated__ "Character.AI lets users create bots in the likeness of any person—without requiring their consent." ...
 $ url        : chr  "https://www.pymnts.com/artificial-intelligence-2/2024/aethir-launches-100-million-ai-fund-as-sony-seeks-ai-game-patent/" "https://www.pymnts.com/amazon/2024/amazon-debuts-ai-powered-tools-for-creating-advertisements/" "https://www.nextgov.com/digital-government/2024/10/white-house-probes-collision-ai-and-personal-data/400289/" "https://www.wired.com/story/characterai-has-a-non-consensual-bot-problem/" ...
 $ publishedAt: POSIXct, format: "2024-10-15 20:12:12" "2024-10-15 20:18:54" ...
 $ content    : chr  "Artificial intelligence (AI) is opening up fresh possibilities across the gaming and sports betting sectors. Re"| __truncated__ "Amazon Ads has debuted two artificial intelligence (AI) tools designed to help advertisers expand their reach.\"| __truncated__ "The Biden administration is mulling new policies for federal agencies that buy data on Americans from commercia"| __truncated__ "Matthew Sag, a distinguished professor at Emory University who researches copyright and artificial intelligence"| __truncated__ ...
 $ pub_diff   : 'difftime' num  NA 0.111666666666667 0.0161111111111111 0.146111111111111 ...
  ..- attr(*, "units")= chr "hours"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View the first few rows of each processed data frame</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tesla_news_processed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               source                   author
1           Frandroid         Grégoire Huvelin
2        Tuxboard.com                    B. L.
3        Quartz India Owen Bellwood / Jalopnik
4             ANSA.it                     &lt;NA&gt;
5 Berliner Morgenpost       FUNKE Mediengruppe
6       Diepresse.com               Die Presse
                                                                                                title
1 Twitch Survoltés #2&nbsp;: une émission spéciale « Mondial de l’auto », tout le programme et les invités
2               Les modèles de voitures qui seront interdits de circuler à partir du 1er janvier 2025
3                                                                 America just set an EV sales record
4                                                 Andrea Stroppa, il braccio destro in Italia di Musk
5                                        Tesla in Grünheide kündigt erneut Mitglied des Betriebsrates
6                                           Tesla erhält erste Genehmigung für Werksausbau bei Berlin
                                                                                                                                                                                                                                                           description
1 Notre seconde émission Twitch Survoltés fait la part belle au Mondial de l’Automobile&nbsp;2024, organisé à Paris du 14 au 20&nbsp;octobre. Au menu du jour&nbsp;: une tripotée de nouvelles voitures électriques françaises et chinoises, un Tesla Killer qui promet, toutes les …
2        C’est la dure loi des voitures… À partir du 1ᵉʳ janvier prochain, certains modèles de voitures n’auront plus le droit...\nL’article Les modèles de voitures qui seront interdits de circuler à partir du 1er janvier 2025 est apparu en premier sur Tuxboard.
3 In recent months, automakers around the world have pledged to shift attention to hybrid models, delay new electric cars and push back production targets for battery-powered vehicles. That might make you think sales of electric vehicles are in dire straits, bu…
4                                                                                                                                                                                                30 anni, ex hacker. Fu consulente di Renzi alla cybersicurezza (ANSA)
5                                                                                                                                           Bereits zum zweiten Mal hat Tesla ein Betriebsratsmitglied entlassen. Die IG Metall geht von einem gezielten Vorgehen aus.
6                                                                                                 Das Land Brandenburg hat dem US-Elektroautokonzern Tesla erlaubt, das Werk in Grünheide auszubauen. Mit der Genehmigung darf eine weitere große Halle gebaut werden.
                                                                                                                                                          url
1 https://www.frandroid.com/survoltes/voitures-electriques/2369530_twitch-survoltes-2-une-emission-speciale-mondial-de-lauto-tout-le-programme-et-les-invites
2                                     https://www.tuxboard.com/les-modeles-de-voiture-qui-seront-interdits-de-circuler-a-partir-du-1er-janvier-2025-14102024/
3                                                                                                   https://qz.com/ev-electric-car-sales-record-us-1851672969
4            https://www.ansa.it/sito/notizie/cronaca/2024/10/15/andrea-stroppa-il-braccio-destro-in-italia-di-musk_03594a99-8b45-43aa-9c25-6974760ad33e.html
5                                     https://www.morgenpost.de/panorama/article407474711/tesla-in-gruenheide-kuendigt-erneut-mitglied-des-betriebsrates.html
6                                                              https://www.diepresse.com/18971202/tesla-erhaelt-erste-genehmigung-fuer-werksausbau-bei-berlin
          publishedAt
1 2024-10-15 17:01:00
2 2024-10-15 17:04:20
3 2024-10-15 17:04:47
4 2024-10-15 17:05:30
5 2024-10-15 17:08:21
6 2024-10-15 17:09:55
                                                                                                                                                                                                                   content
1   Notre seconde émission Twitch Survoltés fait la part belle au Mondial de lAutomobile&nbsp;2024, organisé à Paris du 14 au 20&nbsp;octobre. Au menu du jour&nbsp;: une tripotée de nouvelles voitures électriques franç… [+2933 chars]
2 Tesla s’est imposée comme le leader du marché électrique en France, avec son SUV Model Y (37 127 unités vendues). Mais aussi sa berline Model 3 (24 539 unités).\r\nLa Dacia Spring, quant à elle, occupe… [+1614 chars]
3 In This Story\r\nIn recent months, automakers around the world have pledged to shift attention to hybrid models, delay new electric cars and push back production targets for battery-powered vehicles. T… [+2344 chars]
4 Un enfant prodige dell'informatica arrivato, a soli 30 anni, ad essere il punto di riferimento di Elon Musk in Italia e al suo fianco nel corso dei suoi incontri istituzionali.\r\nUn biglietto da visit… [+3124 chars]
5 Grünheide. Bereits zum zweiten Mal hat Tesla ein Betriebsratsmitglied entlassen. Die IG Metall geht von einem gezielten Vorgehen aus.\r\nDer Elektroautobauer Tesla hat innerhalb von drei Monaten bereit… [+2536 chars]
6 Das Land Brandenburg hat dem US-Elektroautokonzern Tesla erlaubt, das Werk in Grünheide auszubauen. Mit der Genehmigung darf eine weitere große Halle gebaut werden.\r\nTesla erhält vom Land Brandenburg… [+1188 chars]
          pub_diff
1         NA hours
2 0.05555556 hours
3 0.00750000 hours
4 0.01194444 hours
5 0.04750000 hours
6 0.02611111 hours</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ai_news_processed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              source                            author
1         pymnts.com                            PYMNTS
2         pymnts.com                            PYMNTS
3            Nextgov Natalie Alms and David DiMolfetta
4              Wired  Megan Farokhmanesh, Lauren Goode
5      Statetimes.in                 statetimes_editor
6 The Times of India                          The Feed
                                                                             title
1                Aethir Launches $100 Million AI Fund as Sony Seeks AI Game Patent
2                       Amazon Debuts AI-Powered Tools for Creating Advertisements
3                         White House probes the collision of AI and personal data
4   Anyone Can Turn You Into an AI Chatbot. There's Little You Can Do to Stop Them
5                                Modi pitches for global digital rules, ethical AI
6 US election 2024: Did Kamala Harris really use teleprompter? Here's bitter truth
                                                                                                                                                                                                                                                           description
1 Artificial intelligence (AI) is opening up fresh possibilities across the gaming and sports betting sectors. Recent developments showcase this trend, with Aethir launching a $100 million fund for AI and gaming projects, PlayVS teaming up with Omnic.AI for esp…
2 Amazon Ads has debuted two artificial intelligence (AI) tools designed to help advertisers expand their reach. The company’s AI creative studio and Audio generator were both announced Tuesday (Oct. 15) at Amazon Ads’ annual “unboxed” event. “By building a sui…
3                                                                            Policymakers are examining how the advent of artificial intelligence could create new privacy risks around the federal agency purchase and use of personal information from data brokers.
4                                                                                                                                                                   Character.AI lets users create bots in the likeness of any person—without requiring their consent.
5 STATE TIMES NEWS NEW DELHI: Prime Minister Narendra Modi on Tuesday made a fervent pitch for putting in place a global framework for use of digital technology and ethical use of artificial intelligence (AI), saying security cannot be an afterthought in an int…
6        Eminent fact checkers and Univision has debunked the claim of US Vice President Kamala Harris taking help from a teleprompter during a town hall event. Kamala Harris had faced criticisms earlier from various conservative commentators due to this reason.
                                                                                                                                                                 url
1                                            https://www.pymnts.com/artificial-intelligence-2/2024/aethir-launches-100-million-ai-fund-as-sony-seeks-ai-game-patent/
2                                                                     https://www.pymnts.com/amazon/2024/amazon-debuts-ai-powered-tools-for-creating-advertisements/
3                                                       https://www.nextgov.com/digital-government/2024/10/white-house-probes-collision-ai-and-personal-data/400289/
4                                                                                          https://www.wired.com/story/characterai-has-a-non-consensual-bot-problem/
5                                                                                            https://statetimes.in/modi-pitches-for-global-digital-rules-ethical-ai/
6 https://economictimes.indiatimes.com/news/international/us/us-election-2024-did-kamala-harris-really-use-teleprompter-heres-bitter-truth/articleshow/114262401.cms
          publishedAt
1 2024-10-15 20:12:12
2 2024-10-15 20:18:54
3 2024-10-15 20:19:52
4 2024-10-15 20:28:38
5 2024-10-15 20:29:40
6 2024-10-15 20:33:53
                                                                                                                                                                                                                   content
1   Artificial intelligence (AI) is opening up fresh possibilities across the gaming and sports betting sectors. Recent developments showcase this trend, with Aethir launching a $100 million fund for AI … [+4094 chars]
2 Amazon Ads has debuted two artificial intelligence (AI) tools designed to help advertisers expand their reach.\r\nThe companys AI creative studio and Audio generator were both announced Tuesday (Oct. 1… [+2479 chars]
3   The Biden administration is mulling new policies for federal agencies that buy data on Americans from commercial data brokers, citing increased risks posed by the increased use of artificial intellig… [+5723 chars]
4   Matthew Sag, a distinguished professor at Emory University who researches copyright and artificial intelligence, concurs. Even if a user creates a bot intentionally designed to cause emotional distre… [+2845 chars]
5 STATE TIMES NEWS\r\nNEW DELHI: Prime Minister Narendra Modi on Tuesday made a fervent pitch for putting in place a global framework for use of digital technology and ethical use of artificial intellige… [+5319 chars]
6                     Artificial Intelligence(AI)\r\nAI and Analytics based Business Strategy\r\nBy - Tanusree De, Managing Director- Accenture Technology Lead, Trustworthy AI Center of Excellence: ATCI\r\nView Program
          pub_diff
1         NA hours
2 0.11166667 hours
3 0.01611111 hours
4 0.14611111 hours
5 0.01722222 hours
6 0.07027778 hours</code></pre>
</div>
</div>
<ol start="6" type="1">
<li>With each of your resulting two data objects (each a data frame, which is a special case of a list) do the following actions: • Choose one of your data frames. Subset the data frame to only return the date version of publishedAt and the pub_diff variables. Then use one call to the map() function to return the mean, standard deviation, and median of these columns. You should use a custom anonymous function using ‘shorthand’ notation ((x) …). Note that the pub_diff variable includes an NA so you’ll need to set na.rm = TRUE in the calls to mean(0, sd(), and median().</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the summary function</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>summarize_news <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(publishedAt, pub_diff) <span class="sc">%&gt;%</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(\(x) {</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">inherits</span>(x, <span class="st">"POSIXct"</span>)) {</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># For datetime columns (publishedAt)</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">min =</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">max =</span> <span class="fu">max</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">range_days =</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(<span class="fu">max</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">min</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">units =</span> <span class="st">"days"</span>))</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">inherits</span>(x, <span class="st">"difftime"</span>)) {</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># For difftime columns (pub_diff)</span></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>        x_hours <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(x, <span class="at">units =</span> <span class="st">"hours"</span>)</span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(</span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">mean_hours =</span> <span class="fu">mean</span>(x_hours, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">sd_hours =</span> <span class="fu">sd</span>(x_hours, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">median_hours =</span> <span class="fu">median</span>(x_hours, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(<span class="at">mean =</span> <span class="cn">NA</span>, <span class="at">sd =</span> <span class="cn">NA</span>, <span class="at">median =</span> <span class="cn">NA</span>)</span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the function to tesla_news_processed</span></span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a>tesla_summary <span class="ot">&lt;-</span> <span class="fu">summarize_news</span>(tesla_news_processed)</span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-30"><a href="#cb78-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the function to ai_news_processed</span></span>
<span id="cb78-31"><a href="#cb78-31" aria-hidden="true" tabindex="-1"></a>ai_summary <span class="ot">&lt;-</span> <span class="fu">summarize_news</span>(ai_news_processed)</span>
<span id="cb78-32"><a href="#cb78-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-33"><a href="#cb78-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb78-34"><a href="#cb78-34" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Tesla News Summary:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Tesla News Summary:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tesla_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$publishedAt
                      min                       max                range_days 
"2024-10-15 17:01:00 UTC" "2024-10-16 03:30:40 UTC" "1970-01-01 00:00:00 UTC" 

$pub_diff
  mean_hours     sd_hours median_hours 
  0.10600449   0.12739108   0.07194444 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">AI News Summary:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "\nAI News Summary:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ai_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$publishedAt
                      min                       max                range_days 
"2024-10-15 20:12:12 UTC" "2024-10-16 03:24:50 UTC" "1970-01-01 00:00:00 UTC" 

$pub_diff
  mean_hours     sd_hours median_hours 
  0.07283389   0.06954890   0.05083333 </code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>